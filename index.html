<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>纪念我的奶奶</title>
  <link rel="stylesheet" href="./style.css?v=20251215" />
  <link rel="icon" type="image/png" href="images/favicon.png" />
</head>

<body>

<!-- 顶部导航 -->
<header class="topbar">
  <div class="container nav-inner">
    <div class="logo-area">
      <div class="logo-mark">G</div>
      <div class="logo-text">
        <div class="logo-main">For Grandma</div>
        <div class="logo-sub">纪念我的奶奶</div>
      </div>
    </div>

    <nav class="nav-links">
  <a href="#hero">首页</a>
  <a href="#about">我和奶奶的回忆</a>
  <a href="#gallery">照片画廊</a>
  <a href="#family">家人的思念</a>
  <a href="#diary">给奶奶的日常</a>
  <a href="#flower">为她献花</a>
</nav>
  </div>
</header>

<!-- 1) Hero -->
<section id="hero" class="hero">
  <div class="hero-overlay"></div>
  <div class="container hero-content">
    <p class="hero-eyebrow">Dignified farewell · 温柔告别</p>
    <h1 class="hero-title">思念很长，时间很短，<br>但关于奶奶的故事不会消失。</h1>
    <p class="hero-subtitle">
      这里不是告别，而是另一种陪伴。<br>把回忆、照片和想对她说的话留在这里，让爱慢慢发光。
    </p>

    <div class="hero-actions">
      <a href="#family" class="btn primary-btn">写给奶奶的一段话</a>
      <a href="#diary" class="btn ghost-btn">写下今天的日常</a>
    </div>

  </div>
</section>

<!-- 2) 首页大主视觉照片 -->
<section class="featured-photo">
  <div class="container featured-layout">
    <a href="#gallery" class="featured-photo-link" aria-label="点击进入照片画廊">
      <div class="featured-frame">
        <img src="images/nainai-main.jpg" alt="奶奶的一张照片" class="featured-img">
      </div>
    </a>

    <div class="featured-text">
      <p class="section-eyebrow">A Precious Moment · 一张珍贵的照片</p>
      <h2 class="section-title">她一直在我们的记忆里</h2>
      <p>
        这张照片，我一直留着。<br>
        只是看着的时候，就会觉得她还在。
      </p>
      <p class="featured-caption">
        点击左侧照片，进入照片画廊，慢慢翻看更多奶奶的照片。
      </p>
    </div>
  </div>
</section>

<!-- 我和奶奶的回忆（滚动文字 + 右侧固定照片） -->
<section id="memory" class="story-section memory-section">
  <div class="container">
    <div class="story-inner">

      <!-- 左侧：可滚动文字 -->
      <div class="story-text">
        <div class="story-text-scroll">
          <p class="section-eyebrow">HER STORY</p>
          <h2 class="section-title">我和奶奶的回忆</h2>

          <p class="section-subtitle">
            Memories that stay, even when time moves on.
          </p>

          <p>小时候，我经常看她用那把很大的剪刀剪布。剪刀很重，把手的地方缠着白布。她剪的时候手腕会向下压，她的手指早已被挤压的变形。我问她疼不疼，她说已经习惯了。</p>

          <p>布料铺在桌上，她一段一段地剪，很少停。剪刀合上的时候会发出很清楚的声音，在屋里反复响着。她有时会一边剪，一边讲起年轻时候的事。</p>

          <p>她说那时候在服装厂做中山装，一天到晚都是同样的款式。一个衣领，一只袖子，算下来只有几毛钱。她说这话的时候语气很平常，像是在说一件已经很久没人再提起的事情。</p>

          <p>也是在那样的日子里，她开始教我认字。她用一张挂图贴在墙上，指着一个一个字念给我听。我不太记得那些字具体是什么，只记得她念得很慢。</p>

          <p>有时候我们不看挂图，就在地上写字。她用粉笔写，我蹲在一旁看。粉笔落在地上，会起一层白灰，她写得很认真。</p>

          <p>我印象最深的是她写的“你”字。笔画很直，很规整，是楷书的样子。</p>

          <p>我的脑海中总会有这个画面：用粉色粉笔写下的“你”字。那是她教我写的第一个字。</p>

          <p>她说她年轻的时候，只在“扫盲”的时候上过两个月夜校，学会了两千多个常用字。我当时听了，很认真地点头，在心里想：她真厉害。</p>

          <p>再后来，我上了小学。早上总是不想起来，闹钟响了也不动。奶奶会走到床边，数到五，把被子一下子掀开。我一个激灵，立刻清醒过来。</p>

          <p>冬天的时候，她会买一张 6 路公交车的老年月票。那张票是塑封的，边角磨得有点圆，她总是放在衣服口袋里。</p>

          <p>放学后，她在学校门口等我。我一出来，就能看见她站在人群外面，手里拎着袋子。</p>

          <p>接到我以后，我们再一起坐车回家。她会笑着问我学校老师都讲了什么。车一停一走，她会下意识地拉我一下。</p>

          <p>那条路，我们走了很多次。</p>
        </div>
      </div>

      <!-- 右侧：固定照片 -->
      <div class="story-side">
        <div class="story-image-frame">
          <img src="images/nainai-side.jpg" alt="奶奶的照片">
        </div>

        <p class="story-side-caption">
          那个“你”字，<br>
          一直写在我记忆的最上面。
        </p>
      </div>

    </div>
  </div>
</section>

<!-- 4) 照片画廊 -->
<section id="gallery" class="gallery-section">
  <div class="container gallery-layout">
    <div class="gallery-view">
      <button class="gallery-arrow gallery-arrow-left" aria-label="上一张">&#10094;</button>

      <div class="gallery-photo-frame">
        <img id="gallery-current" src="images/nainai1.jpg" alt="奶奶照片" />
      </div>

      <button class="gallery-arrow gallery-arrow-right" aria-label="下一张">&#10095;</button>
    </div>

    <div class="gallery-text">
      <p class="section-eyebrow">Photo Memories · 照片里的她</p>
      <h2 class="section-title">照片画廊</h2>
      <p class="gallery-caption" id="gallery-caption"></p>
    </div>
  </div>
</section>

<!-- 5) 奶奶的故事 · 家人的思念（本地留言） -->
<section id="family" class="family-section">
  <div class="container">
    <p class="section-eyebrow">HER STORY · 她的一生</p>
    <h2 class="section-title">奶奶的故事 · 家人的思念</h2>
    <p class="section-desc">
      这里记录关于她的一生，也是家人共同的记忆。你可以写下你心中的她：一段话、一个瞬间、一句想说却没说出口的话。<br>
      <span class="muted">提示：留言只保存在你现在的手机中，不会自动上传网络。</span>
    </p>

    <div class="family-grid">
      <div class="family-card">
        <div class="form-row">
          <label for="familyName">署名</label>
          <input id="familyName" type="text" placeholder="例如：凝凝" />
        </div>

        <div class="form-row">
          <label for="familyMessage">留言</label>
          <textarea id="familyMessage" placeholder="写下一段你想对奶奶说的话……"></textarea>
        </div>

        <div class="form-actions">
          <button id="addMessageBtn" class="btn primary-btn" type="button">添加留言</button>
          <button id="clearMessagesBtn" class="btn ghost-btn" type="button">清空本机留言</button>
        </div>

        <p class="hint">这是一份“本地留言簿”，不会被传到网上，只会保留在你现在的手机里</p>
      </div>

      <div class="family-card family-list-card">
        <div class="family-list-title">家人的留言</div>
        <div id="guestbookItems"></div>
      </div>
    </div>
  </div>
</section>

<!-- 6) 给奶奶的日常（聊天日记：本地保存） -->
<section id="diary" class="diary-section">
  <div class="container">
    <p class="section-eyebrow">CHAT DIARY · 像聊天一样写下今天</p>
    <h2 class="section-title">给奶奶的日常</h2>
    <p class="section-desc">
      你可以把这里当作一间安静的屋子。写下今天发生的事、想说的话、想念的瞬间。<br>
      <span class="muted">（内容只会保存在你现在的手机里。）</span>
    </p>

    <div class="chat-diary">
      <div class="chat-header">
        <h3>给奶奶的聊天日记</h3>

        <label class="chat-toggle">
          <input type="checkbox" id="chatEchoToggle" checked>
          显示回声
        </label>

        <button id="chatClearBtn" class="ghost-btn small-btn" type="button">清空本机记录</button>
      </div>

      <div id="chatList" class="chat-list"></div>

      <div class="chat-input-area">
  <button id="voiceBtn" class="voice-btn" type="button">点一下开始录音</button>
    <div class="voice-row">
    <span id="voiceStatus" class="voice-status"></span>
    <audio id="voicePreview" class="voice-preview" controls style="display:none;"></audio>
 </div>
  <textarea
    id="chatInput"
    placeholder="今天想跟奶奶说点什么？（Enter 发送；Shift+Enter 换行）"
  ></textarea>

  <button id="chatSendBtn" class="primary-btn send-btn" type="button">发送</button>
</div>
      <div class="chat-footnote">提示：这是一份本地聊天日记，不会传到网上，只会留在你现在使用的手机里。</div>
    </div>
  </div>
</section>

<!-- 7) 献给奶奶的花（本地统计） -->
<section id="flower" class="flower-wrap">
  <div class="container">
    <p class="section-eyebrow">FOR HER · 无声的想念</p>
    <h2 class="section-title">献给奶奶的花</h2>

    <div class="flower-section">
      <p class="flower-subtitle">有些想念，不必写下，只需轻轻放一朵花。</p>

      <button id="offerFlowerBtn" class="offer-flower-btn" type="button">献上一朵花</button>

      <p class="flower-count">
        已献 <span id="flowerCount">0</span> 朵花
      </p>

      <div id="flowerWall" class="flower-wall"></div>

      <p class="hint">在你的手机上，只显示你自己的献花数量。</p>
    </div>
  </div>
</section>
<!-- 底部纪念语 -->
<section class="legacy-section">
  <div class="container legacy-inner">
    <h2 class="legacy-quote">“死亡不是终点，<br>遗忘才是。<br>只要我们记得，<br>她就永远活着。”</h2>
    
    <div class="legacy-divider"></div>
    <h3 class="legacy-title">永远怀念</h3>
    <p class="legacy-years">SINCE 1932 – 2025</p>
  </div>
</section>

<!-- 页脚 -->
<footer class="site-footer">
  <div class="container footer-inner">
    <div>
      <div class="footer-main">纪念我的奶奶 · Forever in our hearts</div>
      <div class="footer-sub">This page is created with love, memories and gratitude. @khal凝凝</div>
    </div>
  </div>
</footer>

<!-- chat.js（单独文件） -->
<script src="./chat.js?v=20251215"></script>

<!-- 画廊 + 留言簿 + 献花（保留在 index，方便你管理） -->
<script>
  // ===== 照片画廊 =====
  const galleryImages = [
    "images/nainai1.jpg",
    "images/nainai2.jpg",
    "images/nainai3.jpg",
    "images/nainai4.jpg"
  ];

  const galleryCaptions = [
    "2019年冬天·东湖",
    "大伯给奶奶拍下的微信头像",
    "我拍下的爸爸和奶奶",
    "我给川川哥和奶奶拍下的合影"
  ];

  let currentIndex = 0;
  const imgEl = document.getElementById("gallery-current");
  const captionEl = document.getElementById("gallery-caption");

  function showImage(index) {
    if (index < 0) currentIndex = galleryImages.length - 1;
    else if (index >= galleryImages.length) currentIndex = 0;
    else currentIndex = index;

    imgEl.src = galleryImages[currentIndex];
    captionEl.textContent = galleryCaptions[currentIndex] || "";
  }

  document.querySelector(".gallery-arrow-left").addEventListener("click", () => showImage(currentIndex - 1));
  document.querySelector(".gallery-arrow-right").addEventListener("click", () => showImage(currentIndex + 1));
  showImage(0);

  // ===== 家人留言（本地 localStorage）=====
  const GUESTBOOK_KEY = "grandma_family_guestbook_v1";
  const nameInput = document.getElementById("familyName");
  const msgInput = document.getElementById("familyMessage");
  const addBtn = document.getElementById("addMessageBtn");
  const clearBtn = document.getElementById("clearMessagesBtn");
  const listEl = document.getElementById("guestbookItems");

  const pad2 = (n) => String(n).padStart(2, "0");
  function formatDate(ts) {
    const d = new Date(ts);
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  }
  function esc(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function loadMsgs(){
    try{
      const raw = localStorage.getItem(GUESTBOOK_KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){ return []; }
  }
  function saveMsgs(arr){
    localStorage.setItem(GUESTBOOK_KEY, JSON.stringify(arr));
  }

  function renderMsgs(){
    const msgs = loadMsgs().sort((a,b)=>b.ts-a.ts);

    if(!msgs.length){
      listEl.innerHTML = `<div class="guestbook-empty">还没有留言。你可以写下第一段关于奶奶的记忆。</div>`;
      return;
    }

    listEl.innerHTML = msgs.map(m=>{
      const who = esc(m.name || "匿名家人");
      const when = formatDate(m.ts);
      const text = esc(m.text || "").replaceAll("\n","<br>");
      return `
        <div class="guestbook-item" data-id="${m.id}">
          <div class="guestbook-meta">
            <span class="who">${who}</span>
            <span class="when">${when}</span>
            <button class="guestbook-delete" type="button">删除</button>
          </div>
          <div class="guestbook-text">${text}</div>
        </div>
      `;
    }).join("");

    document.querySelectorAll(".guestbook-delete").forEach(btn=>{
      btn.addEventListener("click",(e)=>{
        const card = e.target.closest(".guestbook-item");
        const id = card.getAttribute("data-id");
        const ok = confirm("确定要删除这条留言吗？");
        if(!ok) return;
        saveMsgs(loadMsgs().filter(x=>x.id!==id));
        renderMsgs();
      });
    });
  }

  addBtn.addEventListener("click", ()=>{
    const text = (msgInput.value||"").trim();
    if(!text){
      addBtn.textContent = "请先写留言内容";
      setTimeout(()=>addBtn.textContent="添加留言", 900);
      return;
    }

    const arr = loadMsgs();
    arr.unshift({
      id: (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random()),
      name: (nameInput.value||"").trim() || "匿名家人",
      text,
      ts: Date.now()
    });
    saveMsgs(arr);
    msgInput.value = "";
    renderMsgs();

    addBtn.textContent = "已添加";
    setTimeout(()=>addBtn.textContent="添加留言", 700);
  });

  clearBtn.addEventListener("click", ()=>{
    const ok = confirm("确定要清空这台设备上的所有留言吗？此操作不可恢复。");
    if(!ok) return;
    localStorage.removeItem(GUESTBOOK_KEY);
    renderMsgs();
  });

  renderMsgs();

  // ===== 献花（本地统计）=====
  const FLOWER_KEY = "grandma_flower_count_v1";
  const offerBtn = document.getElementById("offerFlowerBtn");
  const countEl = document.getElementById("flowerCount");
  const wallEl = document.getElementById("flowerWall");

  function loadFlowerCount(){
    const raw = localStorage.getItem(FLOWER_KEY);
    const n = raw ? parseInt(raw,10) : 0;
    return Number.isFinite(n) && n>0 ? n : 0;
  }
  function saveFlowerCount(n){ localStorage.setItem(FLOWER_KEY, String(n)); }

  function renderFlowers(){
    const n = loadFlowerCount();
    countEl.textContent = String(n);
    wallEl.innerHTML = "";
    for(let i=0;i<n;i++){
      const s = document.createElement("span");
      s.textContent = "🌸";
      wallEl.appendChild(s);
    }
  }

  offerBtn.addEventListener("click", ()=>{
    const next = loadFlowerCount()+1;
    saveFlowerCount(next);
    renderFlowers();
    const old = offerBtn.textContent;
    offerBtn.textContent = "已献上";
    setTimeout(()=>offerBtn.textContent=old, 700);
  });

  renderFlowers();
</script>
<script src="./chat.js?v=3"></script>
<script src="./voice.js?v=3"></script>
</body>
</html>